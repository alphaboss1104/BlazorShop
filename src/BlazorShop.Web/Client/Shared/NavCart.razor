@inject ILocalStorageService LocalStorage
@attribute [Authorize]

@if (cartProductsCount == null)
{
    <LoadingScreen />
}
else
{
    <a href="/cart" class="widget-header mr-3">
        <div class="icon">
            <i class="icon-sm rounded-circle border fa fa-shopping-cart"></i>
            <span class="notify">@cartProductsCount</span>
        </div>
    </a>
}

@code {
    private int? cartProductsCount;

    protected override async Task OnInitializedAsync()
    {
        var token = await this.LocalStorage.GetItemAsync<string>("authToken");
        this.Http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);

        this.cartProductsCount = await this.Http.GetFromJsonAsync<int>("api/shoppingcarts/count");
    }
}
